webpackJsonp([1],{838:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}function r(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var c=a(4),s=a.n(c),o=a(16),i=a(65),u=(a.n(i),a(186)),d=a(108),m=(a.n(d),a(346)),p=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),h=a(31),E=a(185),g=function(e){function t(e){n(this,t);var a=l(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.toggle=a.toggle.bind(a),a.state={popoverOpen:!1},a}return r(t,e),p(t,[{key:"toggle",value:function(){this.setState({popoverOpen:!this.state.popoverOpen})}},{key:"render",value:function(){return s.a.createElement("span",null,s.a.createElement("span",{className:"alert-primary  fade show",id:"Popover-"+this.props.id,onClick:this.toggle},"Share Link"),s.a.createElement(o.K,{placement:"top",isOpen:this.state.popoverOpen,target:"Popover-"+this.props.id,toggle:this.toggle},s.a.createElement(o.M,null,"Share Link"),s.a.createElement(o.L,null,Object(i.getCurrentHost)()+"/#/vgo#"+this.props.res.id)))}}]),t}(c.Component),f=function(t){function a(e){n(this,a);var t=l(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,e));return t.state={list:null,playingResource:null,peerId:null,presource:null,accountId:null,account:null,purchaseMsg:null,delete:!1,rememberPwd:!0,loadingMsg:"loading ...",accountInfo:null,danger:!1},t.page=1,t.query="",t.secret=window.sessionStorage.getItem("userSec"),t.secret||(t.secret=window.localStorage.getItem("userSec")),t.inviteCode=null,t._input=null,t.deadline=6,t.fee="1",t}return r(a,t),p(a,[{key:"loadResourceList",value:function(t,a){var n=this,l=void 0;a?(a=new e(a).toString("hex"),l={action:"listResource",page:t,query:a}):l={action:"listResource",page:t},Object(d.bshopCall)(l,function(e,t){e&&t&&n.setState({list:t})}.bind(this))}},{key:"toggleDelete",value:function(){this.setState({delete:!this.state.delete})}},{key:"renderDeleteDialog",value:function(){return s.a.createElement(o.A,{isOpen:this.state.delete,toggle:this.toggleDelete.bind(this),className:"modal-danger "+this.props.className},s.a.createElement(o.D,{toggle:this.toggleDelete.bind(this)},"Download VGo Desktop app"),s.a.createElement(o.B,null,s.a.createElement("p",null,"Resource hidding is not supported in web wallet.please ",s.a.createElement("a",{href:"https://github.com/vg0vg0/vgoDesktop",target:"_blank"},"Download Full peer wallet"))),s.a.createElement(o.C,null,s.a.createElement(o.e,{color:"danger",onClick:this.toggleDelete.bind(this)},"OK")))}},{key:"renderTransactionItem",value:function(){return this.state.accountInfo.transactions.map(function(e){return s.a.createElement("tr",null,s.a.createElement("td",null,Object(i.getTransactionName)(e.type)),s.a.createElement("td",null,e.from),s.a.createElement("td",null,e.to),s.a.createElement("td",null,e.amount," VGo"),s.a.createElement("td",null,e.fee," VGo"),s.a.createElement("td",null,e.height))})}},{key:"renderAccountTransactions",value:function(){return this.state.accountInfo.transactions?s.a.createElement(o.R,{hover:!0,bordered:!0,striped:!0,responsive:!0,size:"sm"},s.a.createElement("thead",null,s.a.createElement("tr",null,s.a.createElement("th",null,"Type"),s.a.createElement("th",null,"From"),s.a.createElement("th",null,"To"),s.a.createElement("th",null,"Amount"),s.a.createElement("th",null,"Fee"),s.a.createElement("th",null,"Height"))),s.a.createElement("tbody",null,this.renderTransactionItem())):null}},{key:"rederAccountInfoDialog",value:function(){return this.state.accountInfo?s.a.createElement(o.A,{isOpen:this.state.danger,toggle:this.toggleDanger.bind(this),className:"modal-info "+this.props.className},s.a.createElement(o.D,{toggle:this.toggleDanger.bind(this)},"Account Info."),s.a.createElement(o.B,null,s.a.createElement("p",null," Account ID: ",this.state.accountInfo.rsId),s.a.createElement("p",null," Account PK: ",this.state.accountInfo.pk),s.a.createElement("p",null," Account Balance: ",this.state.accountInfo.balance),s.a.createElement("p",null,"Transactions:"),this.renderAccountTransactions()),s.a.createElement(o.C,null,s.a.createElement(o.e,{color:"danger",onClick:this.toggleDanger.bind(this)},"OK"))):null}},{key:"showAccountInfo",value:function(e){this.toggleDanger();var t=Object(i.getShareHost)()+"/vgo?action=account&rsIdOrPkHex="+e;E.concat(t,function(e,t,a){if(!e){var n=JSON.parse(a);this.setState({accountInfo:n})}}.bind(this))}},{key:"componentDidMount",value:function(){var e=window.location.hash,t=null;if(e){var a=e.indexOf("#",1);a>0&&(t=e.substr(a+1,40))}this.loadResourceList(1,t);var n=Object(i.loadLocalAccount)();n&&(this.setState({account:n}),n.secret&&(this.secret=n.secret))}},{key:"prePage",value:function(){this.page>1&&(this.page--,this.loadResourceList(this.page))}},{key:"nextPage",value:function(){this.page++,this.loadResourceList(this.page)}},{key:"updateInvodeCode",value:function(e){e&&e.target&&(this.inviteCode=e.target.value)}},{key:"rememberPassword",value:function(e){e&&e.target&&this.setState({rememberPwd:e.target.checked})}},{key:"updateSecret",value:function(e){if(e&&e.target){this.secret=e.target.value,this.secret&&this.secret.length;var t=Object(i.calcAccountId)(this.secret);this.setState({accountId:t})}}},{key:"updateQuery",value:function(e){e&&e.target&&(this.query=e.target.value)}},{key:"search",value:function(){this.page=1,this.loadResourceList(this.page,this.query)}},{key:"doLogin",value:function(){if(this.secret&&this.secret.length>39){this.state.rememberPwd?window.localStorage.setItem("userSec",this.secret):window.sessionStorage.setItem("userSec",this.secret);var e=Object(i.createPeerId)(this.secret);this.setState({account:e});var t=e.peerId;this.setState({peerId:t}),t&&this.state.playingResource?this.tryPlay(this.state.playingResource,t):console.log("login err"),Object(i.loadAccountInfo)(e,function(e){e&&this.setState({account:e})}.bind(this))}}},{key:"showPurchase",value:function(e){this.setState({presource:e})}},{key:"doPurchase",value:function(){if(!this.state.account){var e=Object(i.loadLocalAccount)();if(!e)return void this.setState({purchaseMsg:"need login"});this.setState({account:e})}var t=this.state.playingResource.id,a=(this.state.playingResource.price,this.fee),n=this.state.account.pk,l=this.deadline;Object(i.purchaseResource)(t,this.secret,a,l,this.showPurchaseStatus.bind(this),n)}},{key:"showPurchaseStatus",value:function(e,t){var a=this,n=void 0;e?(n="Success,Try download a few minutes later",setTimeout(function(){a.setState({presource:null})},5e3)):n="err."+t,this.setState({purchaseMsg:n})}},{key:"cancelPurchase",value:function(){this.setState({presource:null}),this.setState({playingResource:null})}},{key:"createTempPeerId",value:function(){return"0000"+h(18).toString("hex")}},{key:"isTempPeerId",value:function(e){return e&&e.startsWith("0000")}},{key:"tryPlay",value:function(e,t){if(this.setState({playingResource:e}),!t&&this.state.account&&(t=this.state.account.peerId),t?this.isTempPeerId(t)&&this.setState({peerId:null}):(t=this.createTempPeerId(),this.setState({peerId:t})),t){var a=Object(i.getShareHost)()+"/vgo?action=verifyDownload&resId="+e.id+"&peerId="+t;E.concat({url:a,json:!0},function(a,n,l){if(a)return void console.log(a);l.ok||this.setState({needPay:!0});var r=Object(i.stringToHexString)("random"+(new Date).getTime());this.secret&&(r=Object(i.stringToHexString)(this.secret)),Object(i.startPlayer)(r,t,e)}.bind(this))}}},{key:"delete",value:function(e){}},{key:"renderResourceList",value:function(){var e=this,t=this.state.list;return t?t.map(function(t){return s.a.createElement("tr",null,s.a.createElement("td",null,s.a.createElement(o.e,{size:"sm",className:"btn-html5 btn-brand mr-1 mb-1",onClick:function(a){return e.tryPlay(t)}},s.a.createElement("i",{className:"fa fa-html5"}),s.a.createElement("span",null,"Play or Download"))),s.a.createElement("td",null,t.tags),s.a.createElement("td",null,t.price," VGo"),s.a.createElement("td",null,s.a.createElement(u.a,{rsId:t.owner})),s.a.createElement("td",null,s.a.createElement(g,{id:t.id,res:t})),s.a.createElement("td",null,s.a.createElement("i",{className:"icon-close icons font-2xl d-block mt-4",onClick:e.toggleDelete.bind(e)})))}):null}},{key:"renderPayButton",value:function(){var e=this;return this.state.needPay?s.a.createElement(o.a,{color:"primary"},"After 10% preview,need to ",s.a.createElement(o.e,{color:"danger",size:"sm",onClick:function(t){return e.showPurchase(e.state.playingResource)}},"Pay VGo coins to continue"),s.a.createElement("a",{href:"https://github.com/vg0vg0/vgoDesktop",target:"_blank"},"Download VGo Desktop app to earn VGo coin.")):null}},{key:"renderPlayer",value:function(){return this.state.presource?null:this.state.playingResource?s.a.createElement("div",{id:"playdiv"},s.a.createElement(o.g,null,s.a.createElement(o.j,null,this.renderPayButton(),this.state.playingResource.tags," - ",s.a.createElement(g,{id:this.state.playingResource.id,res:this.state.playingResource}),s.a.createElement(o.b,{color:"success",className:"float-right"},this.state.loadingMsg)),s.a.createElement(o.h,null,s.a.createElement("div",{id:"status"},s.a.createElement("div",null,s.a.createElement("code",{id:"numPeers"},"0 peers"),".",s.a.createElement("code",{id:"downloadSpeed"},"0 b/s ")," / \u2197",s.a.createElement("code",{id:"uploadSpeed"},"0 b/s - "),s.a.createElement("code",{id:"downloaded"})," of",s.a.createElement("code",{id:"total"})," \u2014",s.a.createElement("span",{id:"remaining"}))),s.a.createElement("div",{id:"player",style:{width:"100%"}})))):null}},{key:"renderAccountInfo",value:function(){return this.state.account?s.a.createElement("div",null,s.a.createElement("div",null,s.a.createElement("span",null,"Account Id:",this.state.account.rsId," "),s.a.createElement("span",{className:"alert-warning fade show"},"Balance : ",this.state.account.balance," VGo"))):null}},{key:"renderPurchase",value:function(){var e=this;return this.state.presource?s.a.createElement(o.O,null,s.a.createElement(o.k,{xs:"12"},s.a.createElement(o.r,{timeout:this.state.timeout,in:this.state.fadeIn},s.a.createElement(o.g,null,s.a.createElement(o.j,null,s.a.createElement(o.a,{color:"primary"},"Need to pay VGo to the owner before download.")),s.a.createElement(o.l,{isOpen:!0,id:"collapseExample"},s.a.createElement(o.h,null,s.a.createElement(o.s,null,s.a.createElement("div",{className:"controls"},s.a.createElement(o.u,{className:"input-prepend"},s.a.createElement(o.v,{addonType:"prepend"},s.a.createElement(o.w,null,"Resource Id:")),s.a.createElement(o.t,{id:"prependedInput",size:"16",type:"text",value:this.state.playingResource.id})))),s.a.createElement(o.s,null,s.a.createElement("div",{className:"controls"},s.a.createElement(o.u,{className:"input-prepend"},s.a.createElement(o.v,{addonType:"prepend"},s.a.createElement(o.w,null,"Resource Tags:")),s.a.createElement(o.t,{id:"prependedInput",size:"16",type:"text",value:this.state.playingResource.tags})))),s.a.createElement(o.s,null,s.a.createElement("div",{className:"controls"},s.a.createElement(o.u,{className:"input-prepend"},s.a.createElement(o.v,{addonType:"prepend"},s.a.createElement(o.w,null," Owner:")),s.a.createElement(o.t,{id:"prependedInput",size:"16",type:"text",value:this.state.playingResource.owner})))),s.a.createElement(o.s,null,s.a.createElement("div",{className:"controls"},s.a.createElement(o.u,{className:"input-prepend"},s.a.createElement(o.v,{addonType:"prepend"},s.a.createElement(o.w,null,"Price:")),s.a.createElement(o.t,{id:"appendedPrependedInput",size:"16",type:"text",value:this.state.playingResource.price}),s.a.createElement(o.v,{addonType:"append"},s.a.createElement(o.w,null,"VGo"))))),s.a.createElement(o.s,null,s.a.createElement("div",{className:"controls"},s.a.createElement(o.u,{className:"input-prepend"},s.a.createElement(o.v,{addonType:"prepend"},s.a.createElement(o.w,null,s.a.createElement(m.a,{id:"min123",text:"Fee:",content:"miner fee. 1 by default"}))),s.a.createElement(o.t,{id:"appendedPrependedInput",size:"16",type:"text",onChange:this.updateFee.bind(this),placeholder:"miner Fee 1"}),s.a.createElement(o.v,{addonType:"append"},s.a.createElement(o.w,null,"VGo"))))),s.a.createElement(o.s,null,s.a.createElement("div",{className:"controls"},s.a.createElement(o.u,{className:"input-prepend"},s.a.createElement(o.v,{addonType:"prepend"},s.a.createElement(o.w,null,s.a.createElement(m.a,{id:"dl4545",text:"Deadline:",content:"deadline 5 minutes by default"}))),s.a.createElement(o.t,{id:"appendedPrependedInput",size:"16",onChange:this.updateDeadline.bind(this),type:"text",placeholder:"5 minutes"}),s.a.createElement(o.v,{addonType:"append"},s.a.createElement(o.w,null,"minutes"))))),s.a.createElement("div",null,s.a.createElement("p",null,this.state.purchaseMsg)),s.a.createElement("div",{className:"form-actions"},s.a.createElement(o.e,{type:"submit",color:"primary",onClick:function(t){return e.doPurchase()}},"Pay"),s.a.createElement(o.e,{color:"secondary",onClick:function(t){return e.cancelPurchase()}},"Cancel")))))))):null}},{key:"updateDeadline",value:function(e){e&&e.target&&(this.deadline=e.target.value)}},{key:"updateFee",value:function(e){e&&e.target&&(this.fee=e.target.value)}},{key:"renderAccountId",value:function(){return this.state.accountId?s.a.createElement("p",{className:"text-muted"},"VGo Account ID: ",this.state.accountId):null}},{key:"renderLogIn",value:function(){var e=this;return this.state.presource?null:this.state.playingResource&&!this.state.peerId?s.a.createElement("div",{className:"app flex-row align-items-center"},s.a.createElement(o.m,null,s.a.createElement(o.O,{className:"justify-content-center"},s.a.createElement(o.k,{md:"8"},s.a.createElement(o.i,null,s.a.createElement(o.g,{className:"p-4"},s.a.createElement(o.h,null,s.a.createElement("h1",null,"Login"),s.a.createElement("p",{className:"text-muted"},"A new account will be created for new secret."),this.renderAccountId(),s.a.createElement(o.u,{className:"mb-3"},s.a.createElement(o.v,{addonType:"prepend"},s.a.createElement(o.w,null,s.a.createElement("i",{className:"icon-user"}))),s.a.createElement(o.t,{type:"textarea",name:"textarea-input",id:"textarea-input",rows:"9",placeholder:"Please type VGo secret,length > 40. ",value:this.secret,onChange:this.updateSecret.bind(this)}))),s.a.createElement(o.s,{row:!0},s.a.createElement(o.k,{md:"9"},s.a.createElement(o.s,null,s.a.createElement("input",{type:"checkbox",checked:this.state.rememberPwd,onChange:this.rememberPassword.bind(this)}),s.a.createElement(o.x,{className:"form-check-label",check:!0,htmlFor:"inline-checkbox1"},"Remeber Password")))),s.a.createElement(o.O,null,s.a.createElement(o.k,{xs:"6"},s.a.createElement(o.e,{color:"primary",className:"px-4",onClick:function(t){e.doLogin()}},"Login")))),s.a.createElement(o.g,{className:"text-white bg-primary py-5 d-md-down-none",style:{width:"44%"}},s.a.createElement(o.h,{className:"text-center"},s.a.createElement("div",null,s.a.createElement("h2",null,"Sign up"),s.a.createElement("p",null,"Type a new secret (size > 40) to register."),s.a.createElement("p",null,"Please have a backup of your secret.All of your VGo Coins will be lost if your secret is forget."),s.a.createElement(o.e,{color:"primary",className:"mt-3",active:!0},"Register Now!"))))))))):null}},{key:"renderList",value:function(){var e=this;return this.state.playingResource?null:this.state.presource?null:this.state.playingResource&&this.state.peerId?null:s.a.createElement(o.O,null,s.a.createElement(o.k,null,s.a.createElement(o.g,null,s.a.createElement(o.j,null,s.a.createElement(o.u,{className:"input-prepend"},s.a.createElement(o.v,{addonType:"prepend"},s.a.createElement(o.w,null,s.a.createElement("i",{className:"fa fa-search"}))),s.a.createElement(o.t,{size:"16",id:"query_input",type:"text",placeholder:"search",onChange:this.updateQuery.bind(this)}),s.a.createElement(o.v,{addonType:"append"},s.a.createElement(o.e,{color:"info",onClick:function(t){e.search()}},"Search")))),s.a.createElement(o.h,null,s.a.createElement(o.R,{hover:!0,bordered:!0,striped:!0,responsive:!0,size:"sm"},s.a.createElement("thead",null,s.a.createElement("tr",null,s.a.createElement("th",null,"Play/Download"),s.a.createElement("th",null,"Tags"),s.a.createElement("th",null,"price"),s.a.createElement("th",null,"Owner"),s.a.createElement("th",null,"Share"),s.a.createElement("th",null,"Hide"))),s.a.createElement("tbody",null,this.renderResourceList())),this.rederAccountInfoDialog(),this.renderDeleteDialog(),s.a.createElement("nav",null,s.a.createElement(o.H,null,s.a.createElement(o.I,null,s.a.createElement(o.J,{previous:!0,tag:"button",onClick:function(t){e.prePage()}},"Prev")),s.a.createElement(o.I,{active:!0},s.a.createElement(o.J,{tag:"button"},this.page)),s.a.createElement(o.I,null,s.a.createElement(o.J,{next:!0,tag:"button",onClick:function(t){e.nextPage()}},"Next"))))))))}},{key:"toggleDanger",value:function(){this.setState({danger:!this.state.danger})}},{key:"render",value:function(){return s.a.createElement("div",{className:"animated fadeIn"},this.renderPurchase(),this.renderList(),this.renderPlayer())}}]),a}(c.Component);t.default=f}.call(t,a(1).Buffer)}});
//# sourceMappingURL=1.1f569f8d.chunk.js.map